<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰©ç†ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿé¨“ãƒ¬ãƒãƒ¼ãƒˆ</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <script>
        window.MathJax = {
            loader: { load: ['input/tex', 'output/svg'] },
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                processEscapes: true
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        body {
            font-family: "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif;
            background-color: #f0f2f5;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 210mm; /* A4å¹… */
            margin: 0 auto;
            background-color: #fff;
            padding: 20mm;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            box-sizing: border-box;
            position: relative;
        }
        
        /* å…¥åŠ›æ¬„ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        input[type="text"] {
            border: none;
            border-bottom: 1px solid #ccc;
            font-size: 16px;
            padding: 5px;
            width: 150px;
            background: #fafafa;
        }
        textarea {
            width: 100%;
            min-height: 80px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
            box-sizing: border-box;
            line-height: 1.6;
        }

        /* å°åˆ·ãƒ»ä¿å­˜æ™‚ã®ä¸€æ™‚ç½®æ›ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .print-replacement {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-family: inherit;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            background-color: #fff;
            min-height: 40px;
        }
        
        /* è¦‹å‡ºã—ãƒ‡ã‚¶ã‚¤ãƒ³ */
        h1 { text-align: center; margin-bottom: 20px; }
        h2 {
            background-color: #e3f2fd;
            padding: 10px;
            border-left: 6px solid #2196f3;
            font-size: 18px;
            margin-top: 30px;
        }
        h3 {
            font-size: 16px;
            margin-top: 15px;
            color: #444;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        
        /* ãã®ä»–ãƒ‘ãƒ¼ãƒ„ */
        .cycle-guide {
            background-color: #fff8e1;
            border: 1px dashed #ffc107;
            padding: 10px; font-size: 12px; margin-bottom: 20px; color: #666;
        }
        .question-text {
            font-weight: bold; color: #d32f2f; background: #fff5f5; padding: 10px; border-radius: 4px; line-height: 1.8;
        }
        .procedure-text {
            background: #f1f8e9; padding: 10px; font-size: 14px; border-radius: 4px; line-height: 1.8;
        }
        .header-info {
            display: flex; justify-content: space-between; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 30px;
        }
        .input-group { display: flex; align-items: center; gap: 10px; }

        /* ãƒœã‚¿ãƒ³é¡ */
        .btn-sim {
            display: inline-block; background-color: #2196f3; color: white; padding: 8px 16px; text-decoration: none; border-radius: 4px; font-size: 14px; margin: 5px 0;
        }
        .action-area {
            text-align: center; margin-top: 40px; margin-bottom: 40px; display: flex; justify-content: center; gap: 20px;
        }
        .btn-pdf {
            background-color: #4caf50; color: white; border: none; padding: 15px 30px; font-size: 16px; border-radius: 5px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .btn-png {
            background-color: #ff9800; color: white; border: none; padding: 15px 30px; font-size: 16px; border-radius: 5px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .btn-pdf:hover { background-color: #388e3c; }
        .btn-png:hover { background-color: #f57c00; }

        /* ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ï¼ˆãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—å¯¾å¿œï¼‰ */
        .image-upload-area {
            border: 2px dashed #ccc; padding: 20px; text-align: center; margin-bottom: 15px; border-radius: 8px; cursor: pointer; background-color: #fafafa; transition: background 0.2s;
        }
        .image-upload-area:hover { background-color: #f0f0f0; border-color: #999; }
        .image-upload-area img { max-width: 100%; max-height: 300px; display: none; margin: 0 auto; }
        .upload-placeholder { color: #777; font-size: 14px; }

        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ */
        #loading-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.9); z-index: 9999; justify-content: center; align-items: center; flex-direction: column; font-size: 20px; color: #333;
        }
        .spinner {
            border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 15px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        @media print {
            .no-print { display: none !important; }
            body { background: white; padding: 0; }
            .container { box-shadow: none; padding: 0; max-width: 100%; }
            textarea { display: none; }
            .print-replacement { display: block; }
        }
    </style>
</head>
<body>

<div id="loading-overlay">
    <div class="spinner"></div>
    <div id="loading-text">å‡¦ç†ä¸­...</div>
</div>

<div class="container" id="report-content">
    <h1>ç‰©ç†ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿé¨“ãƒ¬ãƒãƒ¼ãƒˆ</h1>
    
    <div class="header-info">
        <div class="input-group"><label>ã‚¯ãƒ©ã‚¹:</label><input type="text" placeholder="ä¾‹: 2-A"></div>
        <div class="input-group"><label>ç•ªå·:</label><input type="text" placeholder="ä¾‹: 15"></div>
        <div class="input-group"><label>åå‰:</label><input type="text" placeholder="æ°åã‚’å…¥åŠ›"></div>
    </div>

    <div class="cycle-guide">
        <strong>ã€å•ã„ã®ã‚µã‚¤ã‚¯ãƒ«ã€‘ã«ã¤ã„ã¦</strong><br>
        ã€Œ1.å•ã„ã€â†’ã€Œ2.è‡ªåˆ†ã®è€ƒãˆãƒ»ä»®èª¬ã€â†’ã€Œ3.èª¿ã¹ãŸã“ã¨ï¼ˆå®Ÿé¨“ï¼‰ã€â†’ã€Œ4.æ°—ã¥ã„ãŸã“ã¨ã€ã‚’1ã‚µã‚¤ã‚¯ãƒ«ã¨ã—ã¾ã™ã€‚<br>
        ã“ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’ç¹°ã‚Šè¿”ã—ã€å¾—ã‚‰ã‚ŒãŸã€Œæ°—ã¥ã„ãŸã“ã¨ã€ã‚’çµ±åˆã—ã¦è€ƒå¯Ÿã—ãŸã‚‚ã®ã‚’ã€Œ5.ã‚ã‹ã£ãŸã“ã¨ï¼ˆå­¦å•ï¼‰ã€ã¨ã—ã¦è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚
    </div>

    <h2>1. ã‚³ãƒ³ãƒ‡ãƒ³ã‚µãƒ¼ã®å¾®è¦–çš„ç†è§£ã¨ã‚¨ãƒãƒ«ã‚®ãƒ¼ï¼ˆå•é¡Œ [I] å¯¾å¿œï¼‰</h2>
    <a href="https://takeruhonda.github.io/physics-electromagnetism-sim/Electron_micro_physics_2025_17.html" target="_blank" class="btn-sim no-print">ğŸ“¡ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’é–‹ã (Micro Physics)</a>

    <div class="content-box">
        <h3>1. å•ã„ï¼ˆæ¡ä»¶æ¯”è¼ƒï¼‰</h3>
        <div class="question-text">
            å•é¡Œ[I]ã§ã¯ã€Œã‚¹ã‚¤ãƒƒãƒã‚’åˆ‡ã£ãŸï¼ˆ$Q$ä¸€å®šï¼‰ã€çŠ¶æ…‹ã§æ¥µæ¿é–“éš” $d$ ã‚’åºƒã’ãŸãŒã€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®ã‚ˆã†ã«<strong>ã€Œé›»æ± ã‚’ã¤ãªã„ã ã¾ã¾ï¼ˆ$V$ä¸€å®šï¼‰ã€</strong>ã§ $d$ ã‚’åºƒã’ã‚‹ã¨ã€é™é›»ã‚¨ãƒãƒ«ã‚®ãƒ¼ $U$ ã¨é›»å ´ $E$ ã¯ã©ã®ã‚ˆã†ã«å¤‰åŒ–ã™ã‚‹ã‹ï¼Ÿ ã¾ãŸã€ãªãœå•é¡Œ[I]ã®çµæœã¨ç•°ãªã‚‹ã®ã‹ï¼Ÿ
        </div>
    </div>

    <div class="content-box"><h3>2. è‡ªåˆ†ã®è€ƒãˆãƒ»ä»®èª¬</h3><textarea placeholder="é›»æ± ãŒã¤ãªãŒã£ã¦ã„ã‚‹ã¨é›»åœ§ $V$ ã¯... ãªã®ã§ã€æ¥µæ¿ã‚’åºƒã’ã‚‹ã¨ã‚¨ãƒãƒ«ã‚®ãƒ¼ã¯... ã™ã‚‹ã¨äºˆæƒ³ã™ã‚‹ã€‚"></textarea></div>

    <div class="content-box">
        <h3>3. èª¿ã¹ãŸã“ã¨ï¼ˆå®Ÿé¨“æ‰‹é †ï¼‰</h3>
        <div class="procedure-text">
            <ol>
                <li>ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®ã€Œã‚³ãƒ³ãƒ‡ãƒ³ã‚µãƒ¼ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’é–‹ãã€‚ï¼ˆâ€»å¸¸ã«é›»æ± æ¥ç¶šçŠ¶æ…‹ï¼‰</li>
                <li>ã€Œæ¥µæ¿é–“è·é›¢ dã€ã‚’æœ€å°ï¼ˆ1.0mmï¼‰ã«ã—ã€ãã®æ™‚ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ $U$ ã¨é›»å ´ $E$ ã®å€¤ã‚’è¨˜éŒ²ã™ã‚‹ã€‚</li>
                <li>ã€Œæ¥µæ¿é–“è·é›¢ dã€ã‚’åºƒã’ï¼ˆä¾‹: 2.0mmï¼‰ã€$U$ ã¨ $E$ ãŒå¢—ãˆã‚‹ã‹æ¸›ã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹ã€‚</li>
            </ol>
        </div>
        <h3>å®Ÿé¨“çµæœ</h3>
        <textarea placeholder="dã‚’1.0mmã‹ã‚‰2.0mmã«åºƒã’ã‚‹ã¨ã€ã‚¨ãƒãƒ«ã‚®ãƒ¼ U ã¯... é›»å ´ E ã¯... ã«å¤‰åŒ–ã—ãŸã€‚"></textarea>
    </div>

    <div class="content-box"><h3>4. æ°—ã¥ã„ãŸã“ã¨</h3><textarea placeholder="å•é¡Œ[I]ï¼ˆã‚¹ã‚¤ãƒƒãƒOFFï¼‰ã®è¨ˆç®—ã§ã¯ã‚¨ãƒãƒ«ã‚®ãƒ¼ã¯å¢—ãˆãŸãŒã€å®Ÿé¨“ï¼ˆã‚¹ã‚¤ãƒƒãƒONï¼‰ã§ã¯... ã ã£ãŸã€‚"></textarea></div>

    <h2>2. è¤‡é›‘ãªå›è·¯ã®å®šå¸¸çŠ¶æ…‹ã¨é›»ä½ã®ãƒãƒ©ãƒ³ã‚¹ï¼ˆå•é¡Œ [II] å¯¾å¿œï¼‰</h2>
    <a href="https://takeruhonda.github.io/physics-electromagnetism-sim/Electron_circuit_physics_2025_7.html" target="_blank" class="btn-sim no-print">ğŸ”Œ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’é–‹ã (Circuit Physics)</a>

    <div class="content-box">
        <div class="image-upload-area" id="circuit-image-area" onclick="document.getElementById('file-input').click()">
            <div class="upload-placeholder">
                <strong>ğŸ“¸ ã“ã“ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€Œå›³4ï¼ˆå›è·¯å›³ï¼‰ã€ã‚’é¸æŠ</strong><br>
                ã¾ãŸã¯ç”»åƒã‚’ã“ã“ã«ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦ãã ã•ã„
            </div>
            <img id="preview-img" alt="å›è·¯å›³">
            <input type="file" id="file-input" accept="image/*" style="display: none;" onchange="loadImage(event)">
        </div>
    </div>

    <div class="content-box">
        <h3>1. å•ã„</h3>
        <div class="question-text">
            å›³4ï¼ˆä¸Šå›³ï¼‰ã®ã‚ˆã†ãªå›è·¯ã«ãŠã„ã¦ã€ã‚¹ã‚¤ãƒƒãƒã‚’ã™ã¹ã¦é–‰ã˜ã¦æ™‚é–“ãŒçµŒã£ãŸå¾Œã€ä¸­å¤®ã®ã‚³ãƒ³ãƒ‡ãƒ³ã‚µãƒ¼ $C_3$ ã«é›»è·ãŒå…¨ãæºœã¾ã‚‰ãªããªã‚‹ã®ã¯ã€ä»–ã®æŠµæŠ—ã‚„ã‚³ãƒ³ãƒ‡ãƒ³ã‚µãƒ¼ãŒã©ã®ã‚ˆã†ãªé–¢ä¿‚ã®æ™‚ã‹ï¼Ÿ
        </div>
    </div>

    <div class="content-box"><h3>2. è‡ªåˆ†ã®è€ƒãˆãƒ»ä»®èª¬</h3><textarea placeholder="ä¸­å¤®ã«é›»æ°—ãŒæµã‚Œãªã„ã¨ã„ã†ã“ã¨ã¯..."></textarea></div>

    <div class="content-box">
        <h3>3. èª¿ã¹ãŸã“ã¨ï¼ˆå®Ÿé¨“æ‰‹é †ï¼‰</h3>
        <div class="procedure-text">
            <ol>
                <li>å›³4ã¨åŒã˜å›è·¯ã‚’ä½œæˆã—ã€å…¨ã¦ã®ã‚¹ã‚¤ãƒƒãƒã‚’é–‰ã˜ã¦å®šå¸¸çŠ¶æ…‹ã«ã™ã‚‹ã€‚</li>
                <li>æŠµæŠ— $R$ ã‚„å®¹é‡ $C$ ã‚’å¤‰åŒ–ã•ã›ã€ä¸­å¤®ã® $C_3$ ã®é›»è·ãŒ <strong>0</strong> ã«ãªã‚‹æ¡ä»¶ã‚’æ¢ã™ã€‚</li>
            </ol>
        </div>
        <h3>å®Ÿé¨“çµæœ</h3><textarea placeholder="R1ã‚’...Î©, R2ã‚’...Î© ã«è¨­å®šã—ãŸæ™‚ã€C3ã®é›»è·ãŒ0ã«ãªã£ãŸã€‚"></textarea>
    </div>

    <div class="content-box"><h3>4. æ°—ã¥ã„ãŸã“ã¨</h3><textarea placeholder="é›»è·ãŒ0ã«ãªã‚‹æ¡ä»¶ã¯ã€æŠµæŠ—ã®æ¯”ã¨ã‚³ãƒ³ãƒ‡ãƒ³ã‚µãƒ¼ã®æ¯”ãŒ..."></textarea></div>

    <h2>3. ã‚ã‹ã£ãŸã“ã¨ï¼ˆå­¦å•ï¼‰</h2>
    <div class="content-box">
        <p style="font-size:14px; color:#555;">â€»ä¸Šè¨˜ã®2ã¤ã®ã€Œæ°—ã¥ã„ãŸã“ã¨ã€ã‚’çµ±åˆã—ã€è€ƒå¯Ÿã—ã¦è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚</p>
        <textarea style="height: 150px;" placeholder="ä»Šå›ã®å®Ÿé¨“ã‚’é€šã—ã¦ã€ã‚³ãƒ³ãƒ‡ãƒ³ã‚µãƒ¼ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ä¿å­˜ã¨å›è·¯ã®é›»ä½å¹³è¡¡ã«ã¤ã„ã¦ä»¥ä¸‹ã®ã“ã¨ãŒã‚ã‹ã£ãŸã€‚..."></textarea>
    </div>
</div>

<div class="action-area no-print">
    <button class="btn-pdf" onclick="saveReport('pdf')">ğŸ“„ PDFã¨ã—ã¦ä¿å­˜</button>
    <button class="btn-png" onclick="saveReport('png')">ğŸ–¼ï¸ ç”»åƒ(PNG)ã¨ã—ã¦ä¿å­˜</button>
</div>

<script>
    // ç”»åƒèª­ã¿è¾¼ã¿å‡¦ç†
    function loadImage(event) {
        const file = event.target.files[0];
        if (file) readFile(file);
    }
    function readFile(file) {
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            const img = document.getElementById('preview-img');
            img.src = e.target.result;
            img.style.display = 'block';
            document.querySelector('.upload-placeholder').style.display = 'none';
        };
        reader.readAsDataURL(file);
    }
    // ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—å¯¾å¿œ
    const dropArea = document.getElementById('circuit-image-area');
    dropArea.addEventListener('dragover', (e) => { e.preventDefault(); dropArea.style.backgroundColor = '#e3f2fd'; });
    dropArea.addEventListener('dragleave', (e) => { dropArea.style.backgroundColor = '#fafafa'; });
    dropArea.addEventListener('drop', (e) => {
        e.preventDefault(); dropArea.style.backgroundColor = '#fafafa';
        if (e.dataTransfer.files[0] && e.dataTransfer.files[0].type.startsWith('image/')) {
            readFile(e.dataTransfer.files[0]);
        }
    });

    // ä¿å­˜å‡¦ç†ï¼ˆPDF/PNGå…±é€šï¼‰
    async function saveReport(type) {
        const loading = document.getElementById('loading-overlay');
        const loadingText = document.getElementById('loading-text');
        loading.style.display = 'flex';
        loadingText.innerText = (type === 'pdf') ? "PDFã‚’ä½œæˆä¸­..." : "ç”»åƒã‚’ä½œæˆä¸­...";

        await new Promise(resolve => setTimeout(resolve, 100)); // æç”»å¾…ã¡

        try {
            const element = document.getElementById('report-content');
            
            // å…¥åŠ›æ¬„ã‚’ãƒ†ã‚­ã‚¹ãƒˆ(div/span)ã«ç½®æ›
            const textareas = document.querySelectorAll('textarea');
            const inputs = document.querySelectorAll('input[type="text"]');
            const replacements = [];

            textareas.forEach(textarea => {
                const div = document.createElement('div');
                div.className = 'print-replacement';
                div.innerText = textarea.value;
                div.style.minHeight = textarea.clientHeight + 'px';
                textarea.style.display = 'none';
                textarea.parentNode.insertBefore(div, textarea);
                replacements.push({ original: textarea, temp: div });
            });

            inputs.forEach(input => {
                const span = document.createElement('span');
                span.innerText = input.value;
                span.style.borderBottom = "1px solid #333";
                span.style.padding = "0 5px";
                span.style.display = "inline-block";
                span.style.minWidth = "100px";
                input.style.display = 'none';
                input.parentNode.insertBefore(span, input);
                replacements.push({ original: input, temp: span });
            });

            document.querySelectorAll('.no-print').forEach(el => el.style.display = 'none');

            if (type === 'pdf') {
                // PDFä¿å­˜
                const opt = {
                    margin: 10,
                    filename: 'ç‰©ç†ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿé¨“ãƒ¬ãƒãƒ¼ãƒˆ.pdf',
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2, useCORS: true, logging: false },
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                };
                await html2pdf().set(opt).from(element).save();
            } else {
                // PNGä¿å­˜
                const canvas = await html2canvas(element, { scale: 2, useCORS: true });
                const link = document.createElement('a');
                link.download = 'ç‰©ç†ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿé¨“ãƒ¬ãƒãƒ¼ãƒˆ.png';
                link.href = canvas.toDataURL();
                link.click();
            }

            // å¾©å…ƒå‡¦ç†
            replacements.forEach(item => { item.temp.remove(); item.original.style.display = ''; });
            document.querySelectorAll('.no-print').forEach(el => el.style.display = '');

        } catch (error) {
            console.error(error);
            alert('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚\nã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
        } finally {
            loading.style.display = 'none';
        }
    }
</script>

</body>
</html>
